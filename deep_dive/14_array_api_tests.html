<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Array API Tests &mdash; Ivy 1.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="icon" type="image/png" href="https://github.com/unifyai/unifyai.github.io/blob/master/img/externally_linked/ivy_logo_only.png?raw=true">
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Ivy Tests" href="15_ivy_tests.html" />
    <link rel="prev" title="Docstring Examples" href="13_docstring_examples.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Ivy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../background.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design.html">Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extensions.html">Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../deep_dive.html">Deep Dive</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="0_navigating_the_code.html">Navigating the Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="1_function_types.html">Function Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="2_superset_behaviour.html">Superset Behaviour</a></li>
<li class="toctree-l2"><a class="reference internal" href="3_backend_setting.html">Backend Setting</a></li>
<li class="toctree-l2"><a class="reference internal" href="4_arrays.html">Arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="5_containers.html">Containers</a></li>
<li class="toctree-l2"><a class="reference internal" href="6_data_types.html">Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="7_devices.html">Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="8_inplace_updates.html">Inplace Updates</a></li>
<li class="toctree-l2"><a class="reference internal" href="9_function_wrapping.html">Function Wrapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="10_formatting.html">Formatting</a></li>
<li class="toctree-l2"><a class="reference internal" href="11_function_arguments.html">Function Arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="12_docstrings.html">Docstrings</a></li>
<li class="toctree-l2"><a class="reference internal" href="13_docstring_examples.html">Docstring Examples</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Array API Tests</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#running-the-tests">Running the tests</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#using-bash-file">Using bash file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-ide">Using IDE</a></li>
<li class="toctree-l4"><a class="reference internal" href="#re-running-failed-array-api-tests">Re-Running Failed Array API Tests</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#test-skipping">Test Skipping</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="15_ivy_tests.html">Ivy Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="16_ivy_frontends.html">Ivy Frontends</a></li>
<li class="toctree-l2"><a class="reference internal" href="17_ivy_frontends_tests.html">Ivy Frontend Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="18_exception_handling.html">Exception Handling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Functions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/activations.html">Activations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/compilation.html">Compilation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/constants.html">Constants</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/creation.html">Creation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/data_type.html">Data type</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/device.html">Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/elementwise.html">Elementwise</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/extensions.html">Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/general.html">General</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/gradients.html">Gradients</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/layers.html">Layers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/linear_algebra.html">Linear algebra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/losses.html">Losses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/manipulation.html">Manipulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/meta.html">Meta</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/nest.html">Nest</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/norms.html">Norms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/random.html">Random</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/searching.html">Searching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/set.html">Set</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/sorting.html">Sorting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/statistical.html">Statistical</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functional/ivy/utility.html">Utility</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Classes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../data_classes/container.html">Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_classes/array.html">Array</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Framework Classes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../stateful/initializers.html">Initializers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stateful/converters.html">Converters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stateful/optimizers.html">Optimizers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stateful/module.html">Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stateful/layers.html">Layers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stateful/norms.html">Norms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stateful/activations.html">Activations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stateful/sequential.html">Sequential</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ivy"">Ivy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mech"">Ivy mech</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vision"">Ivy vision</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../robot"">Ivy robot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gym"">Ivy gym</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../memory"">Ivy memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../builder"">Ivy builder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../models"">Ivy models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ecosystem"">Ivy ecosystem</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Ivy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../contributing.html">Contributing</a> &raquo;</li>
          <li><a href="../deep_dive.html">Deep Dive</a> &raquo;</li>
      <li>Array API Tests</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/deep_dive/14_array_api_tests.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="array-api-tests">
<h1>Array API Tests<a class="headerlink" href="#array-api-tests" title="Permalink to this heading"></a></h1>
<p>All functions which are present in the <a class="reference external" href="https://data-apis.org/array-api/latest/">Array API Standard</a> have a corresponding unit test in the
<a class="reference external" href="https://github.com/data-apis/array-api-tests">test suite</a> for the standard.</p>
<p>The test suite is included in the ivy repository as a submodule in the folder <a class="reference external" href="https://github.com/unifyai/ivy/tree/20d07d7887766bb0d1707afdabe6e88df55f27a5/ivy_tests">test_array_api</a>,
which we keep updated with the upstream test suite.</p>
<section id="running-the-tests">
<h2>Running the tests<a class="headerlink" href="#running-the-tests" title="Permalink to this heading"></a></h2>
<p>The entire test suite is run independently <a class="reference external" href="https://github.com/unifyai/ivy/tree/20d07d7887766bb0d1707afdabe6e88df55f27a5/.github/workflows">for each backend</a> on every push to the repo.
Therefore, every function which exists in the standard is thoroughly tested for
adherence to the standard on a continuous basis.</p>
<p>You will need to make sure the Array API tests are passing for each backend framework if/when making any changes to Ivy
functions which are part of the standard. If a test fails on the CI, you can see details about the failure under
‘Details’ -&gt; ‘Run [backend] Tests’.</p>
<p>You can also run the tests locally before making a PR. There are two ways to do this: by the terminal or using your IDE.</p>
<section id="using-bash-file">
<h3>Using bash file<a class="headerlink" href="#using-bash-file" title="Permalink to this heading"></a></h3>
<p>Using the terminal, you can run our bash file <a class="reference external" href="https://github.com/unifyai/ivy/blob/d76f0f5ab02d608864eb2c4012af2404da5806c2/test_array_api.sh">test_array_api.sh</a> and specify which framework backend you want to use.
You can use the following command as an example.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/bin/bash -e ./test_array_api.sh  &#39;&lt;insert_chosen_backend&gt;&#39;
</pre></div>
</div>
<p>You can change the argument with any of our other supported frameworks like ‘tensorflow’ or ‘numpy’.</p>
</section>
<section id="using-ide">
<h3>Using IDE<a class="headerlink" href="#using-ide" title="Permalink to this heading"></a></h3>
<p>If you prefer, you can also run a specific test or test file by using your IDE. To make this work, you should set the
backend explicitly in the ‘_array_module.py’ file. You can find it on the ‘array_api_tests’ submodule. At the beginning
of the file, you will see the following line of code <code class="code docutils literal notranslate"><span class="pre">array_module</span> <span class="pre">=</span> <span class="pre">None</span></code>. You need to comment that line and add
the following code:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import ivy as array_module
array_module.set_backend(&quot;&lt;insert_chosen_backend&gt;&quot;)
</pre></div>
</div>
<p>After that, you can run the API test files as you typically would with other tests. Just make sure to not add these
changes to your commit.</p>
</section>
<section id="re-running-failed-array-api-tests">
<h3>Re-Running Failed Array API Tests<a class="headerlink" href="#re-running-failed-array-api-tests" title="Permalink to this heading"></a></h3>
<p>When a hypothesis test fails, the falsifying example is printed on the console by Hypothesis.
For example, in the <code class="code docutils literal notranslate"><span class="pre">test_trace</span></code> Array API Test, we find the following output on running the test:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Falsifying</span> <span class="n">example</span><span class="p">:</span> <span class="n">test_trace</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.e-05</span><span class="p">]]),</span> <span class="n">kw</span><span class="o">=</span><span class="p">{},</span>
<span class="p">)</span>
</pre></div>
</div>
<p>It is always efficient to fix this particular example first, before running any other examples.
In order to achieve this functionality, we can use the <code class="code docutils literal notranslate"><span class="pre">&#64;example</span></code> Hypothesis decorator.
The <code class="code docutils literal notranslate"><span class="pre">&#64;example</span></code> decorator ensures that a specific example is always tested, on running a particular test.
The decorator requires the test arguments as parameters.
For the <code class="code docutils literal notranslate"><span class="pre">test_trace</span></code> Array API Test, we can add the decorator as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@example</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">ivy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">3.5e-46</span><span class="p">]]),</span> <span class="n">kw</span><span class="o">=</span><span class="p">{})</span>
<span class="k">def</span> <span class="nf">test_trace</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">kw</span><span class="p">):</span>
</pre></div>
</div>
<p>This ensures that the given example is always tested while running the test, allowing one to debug the failure
efficiently.</p>
</section>
</section>
<section id="test-skipping">
<h2>Test Skipping<a class="headerlink" href="#test-skipping" title="Permalink to this heading"></a></h2>
<p>Certain tests may need to be skipped when running the array-api test suite. This could be due to a variety of reasons:</p>
<ol class="arabic simple">
<li><p>the test function has a known issue which the <a class="reference external" href="https://github.com/data-apis/array-api/tree/main">array-api test repository</a> developers are working on (e.g. <code class="code docutils literal notranslate"><span class="pre">test_asarray_arrays</span></code>)</p></li>
<li><p>the function itself deviates from the standard (e.g. <code class="code docutils literal notranslate"><span class="pre">test_floor_divide</span></code>)</p></li>
<li><p>there is an issue with the hypothesis test data generation i.e. a failed ‘health check’ (e.g. <code class="code docutils literal notranslate"><span class="pre">test_iop[__imod__(x1_i</span> <span class="pre">&lt;</span> <span class="pre">0</span> <span class="pre">and</span> <span class="pre">x2_i</span> <span class="pre">is</span> <span class="pre">+0)</span> <span class="pre">-&gt;</span> <span class="pre">NaN]</span></code>)</p></li>
<li><p>tolerance issues when asserting output <code class="code docutils literal notranslate"><span class="pre">isequal()</span></code> (e.g. <code class="code docutils literal notranslate"><span class="pre">test_matrix_norm</span></code>)</p></li>
</ol>
<p>All the examples in this list except point 3 (which only occurs with tensorflow) refer to numpy functions, and the first
two are skipped in the <a class="reference external" href="https://github.com/data-apis/array-api/tree/main">array-api test repository</a> also. The data generation and tolerance issues are not skipped in the
array-api repo and are difficult for Ivy developers
to solve as we cannot alter the tests directly. Currently, we import the test suite and run it; we do not
have our own fork that we can tweak at will. The rationale for doing so is that we should adhere as closely to the
standard as possible. These issues have been raised in the array-api test repo and will be addressed in due course.</p>
<p>There are currently two ways to skip array-api tests:</p>
<ol class="arabic simple">
<li><p>in <code class="code docutils literal notranslate"><span class="pre">ivy_tests/array_api_methods_to_test/&lt;submodule&gt;.txt</span></code> and</p></li>
<li><p>in <code class="code docutils literal notranslate"><span class="pre">ivy_tests/skips.txt</span></code></p></li>
</ol>
<p>The first method was implemented before the second. Each <code class="code docutils literal notranslate"><span class="pre">&lt;submodule&gt;.txt</span></code> file contains a comprehensive list
of functions which belong to that submodule, some of which are commented out. The commented-out functions are being
skipped <em>only</em> for the backend(s) that is/are causing the failure, not all the backends. The latter method, on the
other hand, skips a test on <em>all</em> backends, even if
it is just failing on one. The <code class="code docutils literal notranslate"><span class="pre">ivy_tests/skips.txt</span></code> scheme was implemented to skip <em>specific test cases</em>. The array-api
test suite contains a set of special tests which aim to cover edge-case input and particular data type promotion rules
(see <code class="code docutils literal notranslate"><span class="pre">ivy_tests/test_array_api/array_api_tests/test_special_cases.py</span></code>). In <code class="code docutils literal notranslate"><span class="pre">ivy_tests/skips.txt</span></code>, tests are
skipped by writing the filepath + conditions on the input of the test e.g.,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ivy_tests/test_array_api/array_api_tests/test_special_cases.py::test_iop<span class="o">[</span>__ipow__<span class="o">(</span>x1_i is -infinity and x2_i &gt; <span class="m">0</span> and not <span class="o">(</span>x2_i.is_integer<span class="o">()</span> and x2_i % <span class="nv">2</span> <span class="o">==</span> <span class="m">1</span><span class="o">))</span> -&gt; +infinity<span class="o">]</span>
</pre></div>
</div>
<p>is skipping the in-place operations test on the <code class="code docutils literal notranslate"><span class="pre">pow</span></code>
instance method when x1 is -infinity and x2 is a positive, odd float. The result should be +infinity, however there is
an issue with the numpy instance method and an <a class="reference external" href="https://github.com/numpy/numpy/issues/21213">issue</a> has been raised on the numpy repository. Tests are categorised
in <code class="code docutils literal notranslate"><span class="pre">ivy_tests/skips.txt</span></code> according to the backend they are failing on and the reason for the failure. This should
make unskipping temporarily failing tests straightforward once the issue has been resolved, especially if the skip instruction
itself contains the exact input conditions that are failing.</p>
<p><strong>Round Up</strong></p>
<p>This should have hopefully given you a good understanding of how the Array API test suite is used for testing Ivy.</p>
<p>If you’re ever unsure of how best to proceed,
please feel free to engage with the <a class="reference external" href="https://github.com/unifyai/ivy/discussions/1306">array api tests discussion</a>,
or reach out on <a class="reference external" href="https://discord.gg/ZVQdvbzNQJ">discord</a> in the <a class="reference external" href="https://discord.com/channels/799879767196958751/982738404611592256">array api tests channel</a>!</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="13_docstring_examples.html" class="btn btn-neutral float-left" title="Docstring Examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="15_ivy_tests.html" class="btn btn-neutral float-right" title="Ivy Tests" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2022, Ivy Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>